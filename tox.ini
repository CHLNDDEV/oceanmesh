[tox]
envlist = py{310,311,312,313}
isolated_build = True

[testenv]
deps =
    pytest
extras = all
passenv =
    CONDA_PREFIX
    OCEANMESH_PREFIX
setenv =
    MPLBACKEND = agg
    OCEANMESH_PREFIX = {env:CONDA_PREFIX:}
commands =
    python -c "import sys; print('tox python:', sys.version)"
        python -c "import os; import oceanmesh.geometry.point_in_polygon as p; ok=bool(getattr(p,'_COMPILED_KERNEL_AVAILABLE', False)); print('inpoly compiled:', ok); req=os.environ.get('OCEANMESH_REQUIRE_INPOLY_ACCEL','0').strip().lower() not in {'0','false','no','off',''}; \
            (not req or ok) or (_ for _ in ()).throw(SystemExit('OCEANMESH_REQUIRE_INPOLY_ACCEL=1 but compiled inpoly kernel is unavailable'))"
    pytest {posargs} -v

[testenv:.pkg]
passenv =
    CONDA_PREFIX
    OCEANMESH_PREFIX
setenv =
    OCEANMESH_PREFIX = {env:CONDA_PREFIX:}